<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>ç‹‚å®¢çš„æœ‹å‹åœˆ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --wx-green:#07c160;
      --wx-green-dark:#06ad56;
      --wx-bg:#ededed;
      --wx-card:#fff;
      --text:#000;
      --text-2:#576b95;
      --text-3:#888;
      --line:#e5e5e5;
      --link:#576b95;
      --radius:4px;
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0;padding:0}
    body{
      font-family:'Noto Sans SC',-apple-system,BlinkMacSystemFont,'Segoe UI','Helvetica Neue',Arial,sans-serif;
      background:var(--wx-bg);color:var(--text);font-size:16px;line-height:1.6;
      overflow-x:hidden;
    }
    a{color:var(--link);text-decoration:none}
    img{display:block;max-width:100%}
    button{font-family:inherit}
    
    /* ========== é¡¶éƒ¨å¯¼èˆªæ  ========== */
    .navbar{
      position:fixed;top:0;left:0;right:0;z-index:999;
      background:rgba(237,237,237,.98);backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);height:44px;
      display:flex;align-items:center;justify-content:space-between;
      padding:0 16px;
    }
    .nav-left{display:flex;align-items:center;gap:12px}
    .nav-back{
      font-size:18px;color:var(--text-2);cursor:pointer;
      width:32px;height:32px;display:grid;place-items:center;border-radius:50%;
    }
    .nav-back:active{background:rgba(0,0,0,.05)}
    .nav-title{font-size:17px;font-weight:600;color:var(--text)}
    .nav-right{display:flex;align-items:center;gap:8px}
    .nav-icon{
      width:32px;height:32px;border-radius:50%;display:grid;place-items:center;
      font-size:20px;color:var(--text-2);cursor:pointer;
    }
    .nav-icon:active{background:rgba(0,0,0,.05)}
    
    /* ========== é¡¶éƒ¨å°é¢åŒº ========== */
    .cover-wrap{
      margin-top:44px;position:relative;
      height:320px;background:#b0c4de url('') center/cover no-repeat; /* TODO: å°é¢å›¾ */
    }
    .cover-mask{
      position:absolute;inset:0;
      background:linear-gradient(180deg,transparent 60%,rgba(0,0,0,.3));
    }
    .cover-actions{
      position:absolute;right:16px;bottom:16px;z-index:2;
      display:flex;gap:10px;
    }
    .cover-btn{
      background:rgba(0,0,0,.5);backdrop-filter:blur(8px);
      color:#fff;border:none;border-radius:4px;padding:6px 12px;
      font-size:13px;display:flex;align-items:center;gap:6px;cursor:pointer;
    }
    .cover-btn:active{background:rgba(0,0,0,.65)}
    
    /* ========== ç”¨æˆ·ä¿¡æ¯å¡ ========== */
    .user-info{
      position:relative;z-index:3;
      margin:-50px 16px 0;background:var(--wx-card);
      border-radius:12px;padding:16px;box-shadow:0 2px 12px rgba(0,0,0,.08);
    }
    .user-top{display:flex;gap:12px;align-items:flex-start}
    .user-avatar{
      width:64px;height:64px;border-radius:8px;
      background:#ddd url('') center/cover no-repeat; /* TODO: å¤´åƒ */
      border:2px solid #fff;flex-shrink:0;
    }
    .user-detail{flex:1;min-width:0}
    .user-name{
      font-size:20px;font-weight:700;color:var(--text);
      display:flex;align-items:center;gap:8px;margin-bottom:4px;
    }
    .user-badge{
      padding:2px 6px;border-radius:4px;background:#ff9500;
      color:#fff;font-size:11px;font-weight:700;
    }
    .user-desc{font-size:14px;color:var(--text-3);margin-bottom:8px}
    .user-meta{
      display:flex;gap:16px;font-size:13px;color:var(--text-3);
    }
    .user-meta b{color:var(--text);font-weight:600}
    .user-actions{
      display:flex;gap:8px;margin-top:12px;padding-top:12px;
      border-top:1px solid var(--line);
    }
    .btn{
      flex:1;height:36px;border-radius:6px;border:1px solid var(--line);
      background:#fff;color:var(--text-2);font-size:14px;
      display:flex;align-items:center;justify-content:center;gap:6px;
      cursor:pointer;font-weight:500;
    }
    .btn.primary{background:var(--wx-green);border-color:var(--wx-green);color:#fff}
    .btn:active{opacity:.8}
    
    /* ========== Tabs ========== */
    .tabs{
      position:sticky;top:44px;z-index:99;
      background:var(--wx-card);border-bottom:1px solid var(--line);
      display:flex;align-items:center;
      padding:0 16px;
    }
    .tab{
      position:relative;padding:12px 0;margin-right:24px;
      color:var(--text-3);font-size:15px;font-weight:500;cursor:pointer;
    }
    .tab.active{color:var(--text)}
    .tab.active::after{
      content:'';position:absolute;left:0;right:0;bottom:0;height:2px;
      background:var(--wx-green);border-radius:2px;
    }
    
    /* ========== ä¸»ä½“å†…å®¹ ========== */
    .main{padding:12px 0 60px}
    
    /* ========== æœ‹å‹åœˆåŠ¨æ€åˆ—è¡¨ ========== */
    .moment{
      background:var(--wx-card);border-bottom:1px solid var(--line);
      padding:16px;display:flex;gap:12px;
    }
    .moment-avatar{
      width:44px;height:44px;border-radius:4px;
      background:#ddd url('') center/cover no-repeat;
      flex-shrink:0;cursor:pointer;
    }
    .moment-content{flex:1;min-width:0}
    .moment-user{
      color:var(--link);font-size:15px;font-weight:600;
      margin-bottom:4px;cursor:pointer;
    }
    .moment-text{
      font-size:15px;color:var(--text);line-height:1.5;
      margin-bottom:8px;word-wrap:break-word;
    }
    .moment-text.collapsed{
      max-height:60px;overflow:hidden;position:relative;
    }
    .moment-text.collapsed::after{
      content:'';position:absolute;bottom:0;left:0;right:0;height:20px;
      background:linear-gradient(transparent,var(--wx-card));
    }
    .text-expand{
      color:var(--link);font-size:14px;cursor:pointer;margin-top:4px;
    }
    .moment-images{
      display:grid;gap:4px;margin-bottom:8px;
    }
    .moment-images.grid-1{grid-template-columns:1fr;max-width:240px}
    .moment-images.grid-2{grid-template-columns:repeat(2,1fr);max-width:240px}
    .moment-images.grid-3{grid-template-columns:repeat(3,1fr)}
    .moment-images.grid-4{grid-template-columns:repeat(2,1fr);max-width:240px}
    .moment-images.grid-more{grid-template-columns:repeat(3,1fr)}
    .moment-img{
      aspect-ratio:1;background:#f0f0f0 url('') center/cover no-repeat;
      border-radius:4px;cursor:pointer;position:relative;overflow:hidden;
    }
    .moment-img:active{opacity:.9}
    .moment-video{
      aspect-ratio:16/9;background:#000 url('') center/cover no-repeat;
      border-radius:8px;position:relative;cursor:pointer;
    }
    .moment-video::after{
      content:'â–¶';position:absolute;inset:0;
      display:grid;place-items:center;font-size:48px;color:#fff;
      background:rgba(0,0,0,.25);
    }
    .moment-meta{
      display:flex;align-items:center;justify-content:space-between;
      color:var(--text-3);font-size:13px;margin-top:6px;
    }
    .moment-time{display:flex;align-items:center;gap:8px}
    .moment-location{color:var(--link)}
    .moment-more{
      width:24px;height:24px;border-radius:50%;
      display:grid;place-items:center;cursor:pointer;
    }
    .moment-more:active{background:rgba(0,0,0,.05)}
    .moment-interact{
      background:#f7f7f7;border-radius:4px;padding:8px 10px;
      margin-top:8px;
    }
    .moment-likes{
      color:var(--link);font-size:14px;line-height:1.5;
      display:flex;align-items:flex-start;gap:6px;
    }
    .moment-likes::before{content:'â¤ï¸';flex-shrink:0}
    .moment-comments{
      border-top:1px solid var(--line);margin-top:6px;padding-top:6px;
    }
    .comment-item{
      font-size:14px;color:var(--text);line-height:1.5;margin-bottom:4px;
    }
    .comment-user{color:var(--link);font-weight:600}
    .comment-reply{color:var(--link)}
    
    /* ========== ä¾§è¾¹æ ï¼ˆç§»åŠ¨ç«¯åº•éƒ¨å›ºå®šï¼‰ ========== */
    .sidebar{
      position:fixed;bottom:0;left:0;right:0;z-index:999;
      background:var(--wx-card);border-top:1px solid var(--line);
      padding:8px 16px;display:flex;justify-content:space-around;align-items:center;
      box-shadow:0 -2px 8px rgba(0,0,0,.05);
    }
    .sidebar-item{
      display:flex;flex-direction:column;align-items:center;gap:4px;
      color:var(--text-3);font-size:11px;cursor:pointer;
    }
    .sidebar-icon{font-size:24px}
    .sidebar-item.active{color:var(--wx-green)}
    .sidebar-item.active .sidebar-icon{color:var(--wx-green)}
    
    /* ========== ç•™è¨€å¼¹çª— ========== */
    .modal{
      position:fixed;inset:0;z-index:9999;
      background:rgba(0,0,0,.6);display:none;align-items:flex-end;
    }
    .modal.active{display:flex}
    .modal-content{
      background:var(--wx-card);border-radius:16px 16px 0 0;
      width:100%;max-height:80vh;overflow:auto;
      padding:20px 16px;animation:slideUp .3s ease;
    }
    @keyframes slideUp{
      from{transform:translateY(100%)}
      to{transform:translateY(0)}
    }
    .modal-header{
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:16px;
    }
    .modal-title{font-size:18px;font-weight:700}
    .modal-close{
      width:32px;height:32px;border-radius:50%;
      display:grid;place-items:center;color:var(--text-3);
      cursor:pointer;font-size:24px;
    }
    .modal-close:active{background:rgba(0,0,0,.05)}
    .form-group{margin-bottom:16px}
    .form-label{font-size:14px;color:var(--text-2);margin-bottom:6px;display:block}
    .form-input,.form-textarea{
      width:100%;border:1px solid var(--line);border-radius:8px;
      padding:10px 12px;font-size:15px;background:#f7f7f7;
      outline:none;transition:.2s;
    }
    .form-input:focus,.form-textarea:focus{
      border-color:var(--wx-green);background:#fff;
      box-shadow:0 0 0 3px rgba(7,193,96,.1);
    }
    .form-textarea{min-height:120px;resize:vertical;line-height:1.5}
    .char-count{text-align:right;font-size:12px;color:var(--text-3);margin-top:4px}
    .submit-btn{
      width:100%;height:44px;border-radius:8px;border:none;
      background:var(--wx-green);color:#fff;font-size:16px;
      font-weight:600;cursor:pointer;
    }
    .submit-btn:active{background:var(--wx-green-dark)}
    .submit-btn:disabled{opacity:.5;cursor:not-allowed}
    .status-msg{
      margin-top:12px;padding:10px;border-radius:8px;
      text-align:center;font-size:14px;display:none;
    }
    .status-msg.show{display:block}
    .status-msg.success{background:#e6f7ed;color:var(--wx-green);border:1px solid #c3e8d1}
    .status-msg.error{background:#feebeb;color:#fa5151;border:1px solid #fcd1d1}
    
    /* ========== å“åº”å¼ ========== */
    @media (max-width:640px){
      .user-meta{flex-wrap:wrap}
      .moment-images.grid-more{grid-template-columns:repeat(3,1fr)}
    }
    
    /* ========== å·¥å…·ç±» ========== */
    .hidden{display:none !important}
  </style>
</head>
<body>
  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <div class="nav-left">
      <div class="nav-back" onclick="history.back()">â€¹</div>
      <div class="nav-title">æœ‹å‹åœˆ</div>
    </div>
    <div class="nav-right">
      <div class="nav-icon" title="ç›¸æœº" onclick="alert('ç›¸æœºåŠŸèƒ½')">ğŸ“·</div>
    </div>
  </nav>

  <!-- é¡¶éƒ¨å°é¢ -->
  <div class="cover-wrap">
    <div class="cover-mask"></div>
    <div class="cover-actions">
      <button class="cover-btn">âœï¸ æ›´æ¢å°é¢</button>
    </div>
  </div>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ -->
  <div class="user-info">
    <div class="user-top">
      <div class="user-avatar"></div>
      <div class="user-detail">
        <div class="user-name">
          <span>ç‹‚å®¢åŒå­¦</span>
          <span class="user-badge">VIP</span>
        </div>
        <div class="user-desc">è¿™é‡Œæ˜¯ä¸ªæ€§ç­¾åï¼Œæ”¯æŒä¸€è¡Œç®€çŸ­æè¿°ï½</div>
        <div class="user-meta">
          <div><b>128</b> æœ‹å‹</div>
          <div><b>256</b> åŠ¨æ€</div>
          <div><b>1.2K</b> è·èµ</div>
        </div>
      </div>
    </div>
    <div class="user-actions">
      <button class="btn">ğŸ’¬ å‘æ¶ˆæ¯</button>
      <button class="btn primary">â• æ·»åŠ å¥½å‹</button>
      <button class="btn" onclick="openMessageModal()">âœ‰ï¸ ç•™è¨€</button>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active">åŠ¨æ€</div>
    <div class="tab">ç›¸å†Œ</div>
    <div class="tab">è§†é¢‘</div>
  </div>

  <!-- ä¸»ä½“å†…å®¹ -->
  <main class="main">
    <!-- åŠ¨æ€ 1 - çº¯æ–‡æœ¬ -->
    <article class="moment">
      <div class="moment-avatar" style="background-image:url('https://i.pravatar.cc/150?img=1')"></div>
      <div class="moment-content">
        <div class="moment-user">ç‹‚å®¢åŒå­¦</div>
        <div class="moment-text">
          ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‡ºå»èµ°èµ°ï¼åˆ†äº«ä¸€ä¸‹ä»Šå¤©çš„å¥½å¿ƒæƒ… ğŸ˜Š
        </div>
        <div class="moment-meta">
          <div class="moment-time">
            <span>2å°æ—¶å‰</span>
            <span class="moment-location">ğŸ“ åŒ—äº¬Â·æœé˜³åŒº</span>
          </div>
          <div class="moment-more">â‹¯</div>
        </div>
        <div class="moment-interact">
          <div class="moment-likes">å¼ ä¸‰ã€æå››ã€ç‹äº” ç­‰12äººè§‰å¾—å¾ˆèµ</div>
          <div class="moment-comments">
            <div class="comment-item">
              <span class="comment-user">å¼ ä¸‰</span>ï¼šç¡®å®ä¸é”™ï¼
            </div>
            <div class="comment-item">
              <span class="comment-user">æå››</span> å›å¤ <span class="comment-reply">å¼ ä¸‰</span>ï¼š+1
            </div>
          </div>
        </div>
      </div>
    </article>

    <!-- åŠ¨æ€ 2 - å•å›¾ -->
    <article class="moment">
      <div class="moment-avatar" style="background-image:url('https://i.pravatar.cc/150?img=2')"></div>
      <div class="moment-content">
        <div class="moment-user">ç‹‚å®¢åŒå­¦</div>
        <div class="moment-text">è½æ—¥ä½™æ™– ğŸŒ…</div>
        <div class="moment-images grid-1">
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/sunset/600/600')"></div>
        </div>
        <div class="moment-meta">
          <div class="moment-time">
            <span>5å°æ—¶å‰</span>
          </div>
          <div class="moment-more">â‹¯</div>
        </div>
        <div class="moment-interact">
          <div class="moment-likes">ç‹äº” ç­‰5äººè§‰å¾—å¾ˆèµ</div>
        </div>
      </div>
    </article>

    <!-- åŠ¨æ€ 3 - ä¸‰å›¾ -->
    <article class="moment">
      <div class="moment-avatar" style="background-image:url('https://i.pravatar.cc/150?img=3')"></div>
      <div class="moment-content">
        <div class="moment-user">ç‹‚å®¢åŒå­¦</div>
        <div class="moment-text">å‘¨æœ«èšé¤ ğŸœğŸ•ğŸ°</div>
        <div class="moment-images grid-3">
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/food1/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/food2/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/food3/400/400')"></div>
        </div>
        <div class="moment-meta">
          <div class="moment-time">
            <span>æ˜¨å¤© 18:30</span>
            <span class="moment-location">ğŸ“ ä¸‰é‡Œå±¯</span>
          </div>
          <div class="moment-more">â‹¯</div>
        </div>
        <div class="moment-interact">
          <div class="moment-likes">èµµå…­ã€é’±ä¸ƒ ç­‰8äººè§‰å¾—å¾ˆèµ</div>
          <div class="moment-comments">
            <div class="comment-item">
              <span class="comment-user">èµµå…­</span>ï¼šçœ‹èµ·æ¥å¥½å¥½åƒï¼
            </div>
          </div>
        </div>
      </div>
    </article>

    <!-- åŠ¨æ€ 4 - è§†é¢‘ -->
    <article class="moment">
      <div class="moment-avatar" style="background-image:url('https://i.pravatar.cc/150?img=4')"></div>
      <div class="moment-content">
        <div class="moment-user">ç‹‚å®¢åŒå­¦</div>
        <div class="moment-text">åˆ†äº«ä¸€æ®µæ—¥å¸¸ vlog ğŸ“¹</div>
        <div class="moment-video" style="background-image:url('https://picsum.photos/seed/video/800/450')"></div>
        <div class="moment-meta">
          <div class="moment-time">
            <span>3å¤©å‰</span>
          </div>
          <div class="moment-more">â‹¯</div>
        </div>
        <div class="moment-interact">
          <div class="moment-likes">å­™å…« ç­‰15äººè§‰å¾—å¾ˆèµ</div>
          <div class="moment-comments">
            <div class="comment-item">
              <span class="comment-user">å­™å…«</span>ï¼šæ‹å¾—ä¸é”™ï¼
            </div>
            <div class="comment-item">
              <span class="comment-user">å‘¨ä¹</span>ï¼šæœŸå¾…ä¸‹ä¸€æœŸ
            </div>
          </div>
        </div>
      </div>
    </article>

    <!-- åŠ¨æ€ 5 - ä¹å›¾ -->
    <article class="moment">
      <div class="moment-avatar" style="background-image:url('https://i.pravatar.cc/150?img=5')"></div>
      <div class="moment-content">
        <div class="moment-user">ç‹‚å®¢åŒå­¦</div>
        <div class="moment-text">æ—…è¡Œè®°å½• | äº‘å—å¤§ç† ğŸ”ï¸ è¿™æ¬¡æ—…è¡ŒçœŸçš„å¤ªç¾äº†ï¼Œæ¯ä¸€å¸§éƒ½æ˜¯å£çº¸çº§åˆ«çš„é£æ™¯...</div>
        <div class="moment-images grid-more">
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel1/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel2/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel3/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel4/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel5/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel6/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel7/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel8/400/400')"></div>
          <div class="moment-img" style="background-image:url('https://picsum.photos/seed/travel9/400/400')"></div>
        </div>
        <div class="moment-meta">
          <div class="moment-time">
            <span>1å‘¨å‰</span>
            <span class="moment-location">ğŸ“ äº‘å—Â·å¤§ç†</span>
          </div>
          <div class="moment-more">â‹¯</div>
        </div>
        <div class="moment-interact">
          <div class="moment-likes">å´åã€éƒ‘åä¸€ ç­‰28äººè§‰å¾—å¾ˆèµ</div>
          <div class="moment-comments">
            <div class="comment-item">
              <span class="comment-user">å´å</span>ï¼šå¤ªç¾äº†ï¼
            </div>
            <div class="comment-item">
              <span class="comment-user">éƒ‘åä¸€</span>ï¼šä¸‹æ¬¡å¸¦ä¸Šæˆ‘ï¼
            </div>
            <div class="comment-item">
              <span class="comment-user">ç‹‚å®¢åŒå­¦</span> å›å¤ <span class="comment-reply">éƒ‘åä¸€</span>ï¼šå¥½çš„å“ˆå“ˆ
            </div>
          </div>
        </div>
      </div>
    </article>

    <!-- æ›´å¤šåŠ¨æ€å ä½ -->
    <article class="moment">
      <div class="moment-avatar" style="background-image:url('https://i.pravatar.cc/150?img=6')"></div>
      <div class="moment-content">
        <div class="moment-user">ç‹‚å®¢åŒå­¦</div>
        <div class="moment-text">æ—©å®‰ â˜€ï¸</div>
        <div class="moment-meta">
          <div class="moment-time"><span>2å‘¨å‰</span></div>
          <div class="moment-more">â‹¯</div>
        </div>
      </div>
    </article>
  </main>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <div class="sidebar">
    <div class="sidebar-item active">
      <div class="sidebar-icon">ğŸ </div>
      <div>åŠ¨æ€</div>
    </div>
    <div class="sidebar-item">
      <div class="sidebar-icon">ğŸ”</div>
      <div>å‘ç°</div>
    </div>
    <div class="sidebar-item" onclick="openMessageModal()">
      <div class="sidebar-icon">âœ‰ï¸</div>
      <div>ç•™è¨€</div>
    </div>
    <div class="sidebar-item">
      <div class="sidebar-icon">ğŸ‘¤</div>
      <div>æˆ‘çš„</div>
    </div>
  </div>

  <!-- ç•™è¨€å¼¹çª— -->
  <div class="modal" id="messageModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ç»™æˆ‘ç•™è¨€</div>
        <div class="modal-close" onclick="closeMessageModal()">Ã—</div>
      </div>
      <form id="messageForm" onsubmit="submitMessage(event)">
        <div class="form-group">
          <label class="form-label">æ˜µç§° *</label>
          <input class="form-input" id="userName" type="text" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" required maxlength="20"/>
        </div>
        <div class="form-group">
          <label class="form-label">å¾®ä¿¡å·ï¼ˆé€‰å¡«ï¼‰</label>
          <input class="form-input" id="userWechat" type="text" placeholder="æ–¹ä¾¿å›å¤æ—¶è”ç³»æ‚¨"/>
        </div>
        <div class="form-group">
          <label class="form-label">ç•™è¨€å†…å®¹ *</label>
          <textarea class="form-textarea" id="messageContent" placeholder="å†™ä¸‹æ‚¨æƒ³è¯´çš„è¯..." required maxlength="500"></textarea>
          <div class="char-count"><span id="charCount">0</span>/500</div>
        </div>
        <button class="submit-btn" id="submitBtn" type="submit">
          <span id="submitBtnText">å‘é€</span>
        </button>
        <div id="statusMessage" class="status-msg"></div>
      </form>
    </div>
  </div>

  <script>
    // ========== é…ç½® ==========
    const CONFIG = {
      api: {
        submitUrl: '' // TODO: ç•™è¨€æäº¤æ¥å£
      },
      rateLimit: {
        cooldown: 60000,
        maxLength: 500,
        minLength: 5
      }
    };

    // ========== å·¥å…·å‡½æ•° ==========
    function sanitizeInput(text) {
      if (!text) return '';
      return text
        .replace(/<script[^>]*>.*?<\/script>/gi, '')
        .replace(/<[^>]+>/g, '')
        .trim();
    }

    function showStatus(message, type) {
      const el = document.getElementById('statusMessage');
      el.textContent = message;
      el.className = 'status-msg show ' + type;
    }

    function checkCooldown() {
      const last = localStorage.getItem('lastMessageSubmit');
      if (last) {
        const passed = Date.now() - Number(last);
        if (passed < CONFIG.rateLimit.cooldown) {
          const left = Math.ceil((CONFIG.rateLimit.cooldown - passed) / 1000);
          showStatus(`â±ï¸ è¯·ç­‰å¾… ${left} ç§’åå†æ¬¡æäº¤`, 'error');
          return false;
        }
      }
      return true;
    }

    // ========== ç•™è¨€å¼¹çª— ==========
    function openMessageModal() {
      document.getElementById('messageModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeMessageModal() {
      document.getElementById('messageModal').classList.remove('active');
      document.body.style.overflow = '';
      document.getElementById('messageForm').reset();
      document.getElementById('charCount').textContent = '0';
      const el = document.getElementById('statusMessage');
      el.textContent = '';
      el.className = 'status-msg';
    }

    document.getElementById('messageModal').addEventListener('click', e => {
      if (e.target === e.currentTarget) closeMessageModal();
    });

    document.getElementById('messageContent').addEventListener('input', () => {
      const val = document.getElementById('messageContent').value;
      document.getElementById('charCount').textContent = val.length;
    });

    async function submitMessage(e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const btnText = document.getElementById('submitBtnText');
      
      if (btn.disabled) return;

      const userName = sanitizeInput(document.getElementById('userName').value);
      const userWechat = sanitizeInput(document.getElementById('userWechat').value);
      const messageContent = sanitizeInput(document.getElementById('messageContent').value);

      if (!userName || !messageContent) {
        showStatus('âŒ è¯·å¡«å†™å¿…å¡«é¡¹', 'error');
        return;
      }

      if (messageContent.length < CONFIG.rateLimit.minLength) {
        showStatus(`âŒ ç•™è¨€å†…å®¹è‡³å°‘éœ€è¦ ${CONFIG.rateLimit.minLength} ä¸ªå­—ç¬¦`, 'error');
        return;
      }

      if (!checkCooldown()) return;

      btn.disabled = true;
      btnText.textContent = 'å‘é€ä¸­...';

      try {
        const payload = {
          userName,
          userWechat: userWechat || 'æœªæä¾›',
          messageContent,
          timestamp: new Date().toLocaleString('zh-CN', { hour12: false })
        };

        if (CONFIG.api.submitUrl) {
          const res = await fetch(CONFIG.api.submitUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          if (!res.ok) throw new Error('æäº¤å¤±è´¥');
        } else {
          await new Promise(r => setTimeout(r, 800));
        }

        localStorage.setItem('lastMessageSubmit', Date.now().toString());
        showStatus('âœ¨ ç•™è¨€å‘é€æˆåŠŸï¼', 'success');
        setTimeout(closeMessageModal, 1500);
      } catch (err) {
        console.error(err);
        showStatus('âŒ æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
      } finally {
        btn.disabled = false;
        btnText.textContent = 'å‘é€';
      }
    }

    // ========== Tabsåˆ‡æ¢ ==========
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
      });
    });

    // ========== åº•éƒ¨å¯¼èˆªåˆ‡æ¢ ==========
    document.querySelectorAll('.sidebar-item').forEach(item => {
      item.addEventListener('click', function() {
        if (this.textContent.includes('ç•™è¨€')) return;
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
      });
    });

    // ========== æ–‡æœ¬å±•å¼€/æ”¶èµ· ==========
    document.querySelectorAll('.moment-text').forEach(text => {
      if (text.scrollHeight > 60) {
        text.classList.add('collapsed');
        const expandBtn = document.createElement('div');
        expandBtn.className = 'text-expand';
        expandBtn.textContent = 'å±•å¼€';
        text.parentElement.insertBefore(expandBtn, text.nextSibling);
        
        expandBtn.addEventListener('click', () => {
          if (text.classList.contains('collapsed')) {
            text.classList.remove('collapsed');
            expandBtn.textContent = 'æ”¶èµ·';
          } else {
            text.classList.add('collapsed');
            expandBtn.textContent = 'å±•å¼€';
          }
        });
      }
    });
  </script>
</body>
</html>
