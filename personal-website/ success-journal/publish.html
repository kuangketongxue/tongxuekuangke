<!DOCTYPE html>
<html>
<head>
  <title>记录成功日记</title>
  <link rel="stylesheet" href="../shared/global.css">
</head>
<body>
  <iframe src="../shared/nav.html" width="100%" height="70" frameborder="0" scrolling="no"></iframe>

  <div class="container">
    <h2>记录今日成就</h2>
    <textarea id="content" rows="5" placeholder="今天完成了什么？有哪些进步？"></textarea>
    <button onclick="publish()">保存日记</button>
    <button onclick="window.location.href='index.html'">取消</button>
  </div>

  <script src="../shared/leancloud-init.js"></script>
  <script>
    if (!AV.User.current()) {
      alert('请先登录！');
      window.location.href = '../shared/login.html';
    }

    function publish() {
      const content = document.getElementById('content').value.trim();
      if (!content) { alert('内容不能为空！'); return; }
      
      const Post = AV.Object.extend('Post');
      const post = new Post();
      post.set('content', content);
      post.set('type', 'journal'); // 这里改为日记类型
      post.set('author', AV.User.current());
      post.set('likeCount', 0);
      post.set('commentCount', 0);
      
      post.save().then(() => {
        alert('记录成功！');
        window.location.href = 'index.html';
      }).catch(err => alert('保存失败：' + err.message));
    }
  </script>
</body>
</html>
