<!DOCTYPE html>
<html>
<head>
  <title>发布朋友圈</title>
  <link rel="stylesheet" href="../shared/global.css">
</head>
<body>
  <iframe src="../shared/nav.html" width="100%" height="70" frameborder="0" scrolling="no"></iframe>

  <div class="container">
    <h2>发布新动态</h2>
    <textarea id="content" rows="5" placeholder="分享今天的想法..."></textarea>
    <button onclick="publish()">发布</button>
    <button onclick="window.location.href='index.html'">取消</button>
  </div>

  <script src="../shared/leancloud-init.js"></script>
  <script>
    // 检查登录状态
    if (!AV.User.current()) {
      alert('请先登录！');
      window.location.href = '../shared/login.html';
    }

    // 发布动态
    function publish() {
      const content = document.getElementById('content').value.trim();
      if (!content) { alert('内容不能为空！'); return; }
      
      const Post = AV.Object.extend('Post');
      const post = new Post();
      post.set('content', content);
      post.set('type', 'friendCircle'); // 朋友圈类型
      post.set('author', AV.User.current());
      post.set('likeCount', 0); // 初始点赞数
      post.set('commentCount', 0); // 初始评论数
      
      post.save().then(() => {
        alert('发布成功！');
        window.location.href = 'index.html';
      }).catch(err => alert('发布失败：' + err.message));
    }
  </script>
</body>
</html>
